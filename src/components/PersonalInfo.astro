---
import { getGuest, stops } from "@domain/Guest";
import Field from "./Field.astro";
export interface Props {
	id: string;
}

const guest = await getGuest(Astro.props.id);
const arrayFrom = (n: number) => Array.from({ length: n }, (_, i) => i + 1);
---

{ guest &&
<div x-data={`{expanded: ${guest.bus}}`} class="flex flex-col justify-center items-center w-full">
  <h2 class="text-center">
    <div
      x-bind:class="shown ? 'translate-x-0 opacity-1' : 'opacity-0 translate-x-[50%]'"
      class="text-2xl font-hand mb-2 transition-all ease-in-out duration-700">Invitacion Para:</div>
    <div
    x-bind:class="shown ? 'translate-x-0 opacity-1' : 'opacity-0 translate-x-[-50%]'"
    class="text-4xl font-hand mb-4 transition-all ease-in-out duration-700">{guest.name}</div>
  </h2>
  <div
  x-bind:class="shown ? 'opacity-1' : 'opacity-0'"
  class="bg-white p-6 shadow-md rounded-md w-full max-w-screen-md transition-all ease-in-out delay-100 duration-700">
    <h3 class="text-xl mb-4 text-center w-full">Confirma tus datos</h3>
    <form class="space-y-4" hx-put={`/api/confirm/${guest.uuid}`} hx-target="#confirmation-message">
      <!-- Asistentes -->
      <Field>
        <label for="confirmedAttendees" class="font-bold"
          >Asistentes:</label
        >
        <select
          id="confirmedAttendees"
          name="confirmedAttendees"
          class="border rounded-md px-4 py-2 border-gray-300 bg-white"
          required
        >
          <option disabled selected value=""></option>
          {arrayFrom(guest.expectedAttendees).map((numAttendees) => (
            <option selected={guest.confirmedAttendees === numAttendees} value={numAttendees}>{numAttendees}</option>
          ))}
        </select>
      </Field>
      <!-- Alergias -->
      <Field>
        <label for="allergies" class="font-bold"
          >Alergias:</label
        >
        <textarea
          id="allergies"
          name="allergies"
          rows="3"
          class="border rounded-md px-4 py-2 border-gray-300">{guest.allergies}</textarea>
      </Field>
      <!-- Bus -->
      <Field>
        <label for="bus" class="font-bold">Quieres autobus?:
          <input
            id="bus"
            name="bus"
            type="checkbox"
            checked={guest.bus}
            x-on:change="expanded = $event.target.checked"
          />
        </label>
      </Field>
      <!-- Parada -->
      <fieldset class="grid grid-cols-2 space-x-2" x-show="expanded" x-collapse>
        <Field>
          <label for="busStop" class="font-bold">Parada:</label>
          <select
            id="busStop"
            name="busStop"
            class="border rounded-md px-4 py-2 border-gray-300 bg-white"
          >
            <option disabled selected value=""></option>
            {stops.map((busStop) => (
              <option selected={guest.busStop === busStop} value={busStop}>{busStop}</option>
            ))}
          </select>
        </Field>
        <!-- Asientos -->
        <Field>
          <label for="busSeats" class="font-bold"
            >Asientos:</label
          >
          <select
            id="busSeats"
            name="busSeats"
            class="border rounded-md px-4 py-2 border-gray-300 bg-white"
          >
            <option disabled selected value=""></option>
            {arrayFrom(guest.expectedAttendees).map((numAttendees) => (
              <option selected={guest.busSeats === numAttendees} value={numAttendees}>{numAttendees}</option>
            ))}
          </select>
        </Field>
      </fieldset>
      <button type="submit" class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-md w-full">
        {!guest.confirmedAttendees ? "Confirmar" : "Actualizar"}
      </button>
    </form>
    <div id="confirmation-message"></div>
  </div>
</div>
}
